# ğŸ¯ Fluxograma Completo do Sistema de Quiz - MENVO

## ğŸ“Š VisÃ£o Geral do Fluxo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. PÃGINA INICIAL DO QUIZ                        â”‚
â”‚                      app/quiz/page.tsx                              â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ UsuÃ¡rio clica em "ComeÃ§ar QuestionÃ¡rio"                         â”‚
â”‚  â€¢ Estado: showQuiz = false â†’ true                                 â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Renderiza <QuizForm />                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. COMPONENTE QUIZ FORM                          â”‚
â”‚                  components/quiz/QuizForm.tsx                       â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ Props: onSubmit, onBack                                          â”‚
â”‚  â€¢ Estado local: formData (Partial<QuizFormData>)                  â”‚
â”‚  â€¢ currentStep (1-8)                                                â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â€¢ Renderiza 8 perguntas sequencialmente                           â”‚
â”‚  â€¢ Valida cada resposta antes de avanÃ§ar                           â”‚
â”‚  â€¢ Armazena respostas em formData                                  â”‚
â”‚                                                                     â”‚
â”‚  PERGUNTAS:                                                         â”‚
â”‚  1. Momento de carreira (RadioGroup)                               â”‚
â”‚  2. Desafio profissional (TextareaWithVoice)                       â”‚
â”‚  3. ExperiÃªncia com mentoria (RadioGroup)                          â”‚
â”‚  4. VisÃ£o de futuro (TextareaWithVoice)                            â”‚
â”‚  5. Ãreas de desenvolvimento (Checkbox mÃºltiplo)                   â”‚
â”‚  6. Ajuda vida pessoal (TextareaWithVoice)                         â”‚
â”‚  7. Compartilhar conhecimento (RadioGroup)                         â”‚
â”‚  8. Dados de contato (Input: nome, email, linkedin)               â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Ao finalizar: chama onSubmit(formData)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 3. HANDLER DE SUBMIT (Frontend)                     â”‚
â”‚              app/quiz/page.tsx â†’ handleQuizSubmit()                 â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ data: QuizFormData (todas as respostas)                         â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3.1. Criar cliente Supabase                             â”‚      â”‚
â”‚  â”‚      const supabase = createClient()                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3.2. Inserir no banco de dados                          â”‚      â”‚
â”‚  â”‚      supabase.from("quiz_responses").insert({...})      â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚      Campos salvos:                                      â”‚      â”‚
â”‚  â”‚      â€¢ name, email, linkedin_url                         â”‚      â”‚
â”‚  â”‚      â€¢ career_moment                                     â”‚      â”‚
â”‚  â”‚      â€¢ mentorship_experience                             â”‚      â”‚
â”‚  â”‚      â€¢ development_areas (array)                         â”‚      â”‚
â”‚  â”‚      â€¢ current_challenge                                 â”‚      â”‚
â”‚  â”‚      â€¢ future_vision                                     â”‚      â”‚
â”‚  â”‚      â€¢ share_knowledge                                   â”‚      â”‚
â”‚  â”‚      â€¢ personal_life_help                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3.3. Enviar email de convite (fire & forget)            â”‚      â”‚
â”‚  â”‚      supabase.functions.invoke("send-invite-email")     â”‚      â”‚
â”‚  â”‚      â€¢ NÃ£o bloqueia o fluxo                              â”‚      â”‚
â”‚  â”‚      â€¢ Erro Ã© apenas logado                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3.4. Toast de feedback                                   â”‚      â”‚
â”‚  â”‚      "QuestionÃ¡rio enviado!"                             â”‚      â”‚
â”‚  â”‚      "Processando sua anÃ¡lise com IA..."                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3.5. Chamar Edge Function de anÃ¡lise                    â”‚      â”‚
â”‚  â”‚      supabase.functions.invoke("analyze-quiz")          â”‚      â”‚
â”‚  â”‚      body: { responseId: response.id }                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Redireciona para: /quiz/results/{response.id}                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BANCO DE DADOS                              â”‚
â”‚                    Supabase PostgreSQL                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  4. TABELA: quiz_responses                          â”‚
â”‚                                                                     â”‚
â”‚  ESTRUTURA:                                                         â”‚
â”‚  â€¢ id (UUID, PK)                                                    â”‚
â”‚  â€¢ name (text)                                                      â”‚
â”‚  â€¢ email (text)                                                     â”‚
â”‚  â€¢ linkedin_url (text, nullable)                                    â”‚
â”‚  â€¢ career_moment (text)                                             â”‚
â”‚  â€¢ mentorship_experience (text)                                     â”‚
â”‚  â€¢ development_areas (text[])                                       â”‚
â”‚  â€¢ current_challenge (text)                                         â”‚
â”‚  â€¢ future_vision (text)                                             â”‚
â”‚  â€¢ share_knowledge (text)                                           â”‚
â”‚  â€¢ personal_life_help (text)                                        â”‚
â”‚  â€¢ score (integer, nullable) â† calculado pela IA                   â”‚
â”‚  â€¢ ai_analysis (jsonb, nullable) â† resultado da anÃ¡lise            â”‚
â”‚  â€¢ processed_at (timestamp, nullable)                               â”‚
â”‚  â€¢ email_sent (boolean, default false)                              â”‚
â”‚  â€¢ email_sent_at (timestamp, nullable)                              â”‚
â”‚  â€¢ created_at (timestamp)                                           â”‚
â”‚  â€¢ updated_at (timestamp)                                           â”‚
â”‚                                                                     â”‚
â”‚  RLS POLICIES:                                                      â”‚
â”‚  â€¢ Public pode inserir (quiz pÃºblico)                               â”‚
â”‚  â€¢ Public pode ler por email                                        â”‚
â”‚  â€¢ Public pode atualizar (para Edge Functions)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EDGE FUNCTIONS (Deno)                          â”‚
â”‚                    Supabase Functions                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              5. EDGE FUNCTION: analyze-quiz                         â”‚
â”‚           supabase/functions/analyze-quiz/index.ts                  â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ body: { responseId: string }                                     â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.1. Buscar resposta do banco                            â”‚      â”‚
â”‚  â”‚      SELECT * FROM quiz_responses WHERE id = ?           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.2. Buscar mentores disponÃ­veis                         â”‚      â”‚
â”‚  â”‚      SELECT * FROM profiles                              â”‚      â”‚
â”‚  â”‚      WHERE is_mentor = true                              â”‚      â”‚
â”‚  â”‚      AND availability_status = 'available'               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.3. Gerar prompt para IA                                â”‚      â”‚
â”‚  â”‚      generateAnalysisPrompt(response, mentors)           â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚      Inclui:                                             â”‚      â”‚
â”‚  â”‚      â€¢ Todas as respostas do usuÃ¡rio                     â”‚      â”‚
â”‚  â”‚      â€¢ Lista de mentores reais disponÃ­veis               â”‚      â”‚
â”‚  â”‚      â€¢ InstruÃ§Ãµes de anÃ¡lise                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.4. Chamar OpenAI API                                   â”‚      â”‚
â”‚  â”‚      Model: gpt-4o-mini                                  â”‚      â”‚
â”‚  â”‚      Temperature: 0.7                                    â”‚      â”‚
â”‚  â”‚      Response format: JSON                               â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚      Solicita:                                           â”‚      â”‚
â”‚  â”‚      â€¢ PontuaÃ§Ã£o (0-1000)                                â”‚      â”‚
â”‚  â”‚      â€¢ TÃ­tulo personalizado                              â”‚      â”‚
â”‚  â”‚      â€¢ Resumo motivador                                  â”‚      â”‚
â”‚  â”‚      â€¢ Mentores sugeridos (com nomes reais)              â”‚      â”‚
â”‚  â”‚      â€¢ Conselhos prÃ¡ticos                                â”‚      â”‚
â”‚  â”‚      â€¢ PrÃ³ximos passos                                   â”‚      â”‚
â”‚  â”‚      â€¢ Ãreas de desenvolvimento                          â”‚      â”‚
â”‚  â”‚      â€¢ Mensagem final                                    â”‚      â”‚
â”‚  â”‚      â€¢ Potencial mentor (boolean)                        â”‚      â”‚
â”‚  â”‚      â€¢ Ãreas vida pessoal                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.5. Fallback se IA falhar                               â”‚      â”‚
â”‚  â”‚      generateFallbackAnalysis(response, mentors)         â”‚      â”‚
â”‚  â”‚      â€¢ AnÃ¡lise baseada em regras                         â”‚      â”‚
â”‚  â”‚      â€¢ Garante que sempre hÃ¡ resultado                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.6. Atualizar banco com anÃ¡lise                         â”‚      â”‚
â”‚  â”‚      UPDATE quiz_responses SET                           â”‚      â”‚
â”‚  â”‚        ai_analysis = {...},                              â”‚      â”‚
â”‚  â”‚        score = pontuacao,                                â”‚      â”‚
â”‚  â”‚        processed_at = NOW()                              â”‚      â”‚
â”‚  â”‚      WHERE id = responseId                               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5.7. Chamar funÃ§Ã£o de envio de email                     â”‚      â”‚
â”‚  â”‚      supabase.functions.invoke("send-quiz-email")        â”‚      â”‚
â”‚  â”‚      â€¢ AssÃ­ncrono, nÃ£o bloqueia                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Status 200 + anÃ¡lise completa                                   â”‚
â”‚  â€¢ Ou erro com fallback                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           6. EDGE FUNCTION: send-quiz-email                         â”‚
â”‚         supabase/functions/send-quiz-email/index.ts                 â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ body: { responseId: string }                                     â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 6.1. Buscar resposta com anÃ¡lise                         â”‚      â”‚
â”‚  â”‚      SELECT * FROM quiz_responses WHERE id = ?           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 6.2. Verificar se jÃ¡ foi enviado                         â”‚      â”‚
â”‚  â”‚      if (email_sent) return                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 6.3. Montar HTML do email                                â”‚      â”‚
â”‚  â”‚      â€¢ TÃ­tulo personalizado                              â”‚      â”‚
â”‚  â”‚      â€¢ PontuaÃ§Ã£o                                         â”‚      â”‚
â”‚  â”‚      â€¢ Resumo da anÃ¡lise                                 â”‚      â”‚
â”‚  â”‚      â€¢ Link para ver resultado completo                  â”‚      â”‚
â”‚  â”‚      â€¢ Brinde (se score >= 700)                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 6.4. Enviar via Brevo API                                â”‚      â”‚
â”‚  â”‚      POST https://api.brevo.com/v3/smtp/email            â”‚      â”‚
â”‚  â”‚      â€¢ From: contato@menvo.com.br                        â”‚      â”‚
â”‚  â”‚      â€¢ To: user email                                    â”‚      â”‚
â”‚  â”‚      â€¢ Subject: "Sua AnÃ¡lise Personalizada - MENVO"      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 6.5. Atualizar status de envio                           â”‚      â”‚
â”‚  â”‚      UPDATE quiz_responses SET                           â”‚      â”‚
â”‚  â”‚        email_sent = true,                                â”‚      â”‚
â”‚  â”‚        email_sent_at = NOW()                             â”‚      â”‚
â”‚  â”‚      WHERE id = responseId                               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Status 200 se sucesso                                            â”‚
â”‚  â€¢ Erro se falhar                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           7. EDGE FUNCTION: send-invite-email                       â”‚
â”‚        supabase/functions/send-invite-email/index.ts                â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ body: { name: string, email: string }                            â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â€¢ Envia email de boas-vindas                                       â”‚
â”‚  â€¢ Convite para acessar plataforma MENVO                           â”‚
â”‚  â€¢ NÃ£o bloqueia o fluxo principal                                  â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Fire & forget (erro apenas logado)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                8. PÃGINA DE RESULTADOS                              â”‚
â”‚              app/quiz/results/[id]/page.tsx                         â”‚
â”‚                                                                     â”‚
â”‚  INPUT:                                                             â”‚
â”‚  â€¢ params.id (UUID da resposta)                                     â”‚
â”‚                                                                     â”‚
â”‚  PROCESSAMENTO:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 8.1. useEffect ao montar                                 â”‚      â”‚
â”‚  â”‚      loadResults()                                       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 8.2. Buscar resultado do banco                           â”‚      â”‚
â”‚  â”‚      SELECT * FROM quiz_responses WHERE id = ?           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 8.3. Verificar se processado                             â”‚      â”‚
â”‚  â”‚      if (!processed_at) {                                â”‚      â”‚
â”‚  â”‚        setTimeout(loadResults, 2000) // retry            â”‚      â”‚
â”‚  â”‚      }                                                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 8.4. Renderizar anÃ¡lise                                  â”‚      â”‚
â”‚  â”‚      â€¢ TÃ­tulo personalizado                              â”‚      â”‚
â”‚  â”‚      â€¢ PontuaÃ§Ã£o                                         â”‚      â”‚
â”‚  â”‚      â€¢ SeleÃ§Ã£o de brinde (se >= 700)                     â”‚      â”‚
â”‚  â”‚      â€¢ Mentores sugeridos                                â”‚      â”‚
â”‚  â”‚      â€¢ Conselhos prÃ¡ticos                                â”‚      â”‚
â”‚  â”‚      â€¢ PrÃ³ximos passos                                   â”‚      â”‚
â”‚  â”‚      â€¢ Ãreas de desenvolvimento                          â”‚      â”‚
â”‚  â”‚      â€¢ Mensagem final                                    â”‚      â”‚
â”‚  â”‚      â€¢ Badge "Potencial Mentor" (se aplicÃ¡vel)           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â”‚                                              â”‚
â”‚                      â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 8.5. AÃ§Ãµes de compartilhamento                           â”‚      â”‚
â”‚  â”‚      â€¢ Enviar por email (chama send-quiz-email)          â”‚      â”‚
â”‚  â”‚      â€¢ Compartilhar no WhatsApp                          â”‚      â”‚
â”‚  â”‚      â€¢ Compartilhar no LinkedIn                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  OUTPUT:                                                            â”‚
â”‚  â€¢ Interface visual com toda anÃ¡lise                                â”‚
â”‚  â€¢ OpÃ§Ãµes de compartilhamento                                      â”‚
â”‚  â€¢ SeleÃ§Ã£o de brinde (se elegÃ­vel)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


---

## ğŸ”„ Fluxo Resumido por Camadas

### ğŸ“± CAMADA DE APRESENTAÃ‡ÃƒO (Frontend)
```
app/quiz/page.tsx
    â†“
components/quiz/QuizForm.tsx
    â†“
app/quiz/results/[id]/page.tsx
```

**Responsabilidades:**
- Capturar input do usuÃ¡rio (8 perguntas)
- Validar respostas antes de avanÃ§ar
- Exibir feedback visual (toast, loading)
- Renderizar resultados da anÃ¡lise
- Permitir compartilhamento

---

### ğŸ£ CAMADA DE HOOKS (Estado e LÃ³gica)
```
hooks/useToast.ts
    â†“ (feedback visual)
useState/useEffect
    â†“ (gerenciamento de estado local)
```

**Responsabilidades:**
- Gerenciar estado do formulÃ¡rio
- Controlar navegaÃ§Ã£o entre perguntas
- Polling de resultados (retry se nÃ£o processado)
- Feedback de loading/erro

---

### ğŸ”§ CAMADA DE SERVIÃ‡OS (Client-side)
```
utils/supabase/client.ts
    â†“ (cliente Supabase)
Supabase Client API
```

**Responsabilidades:**
- Criar cliente Supabase autenticado
- Fazer queries ao banco
- Invocar Edge Functions
- Gerenciar conexÃ£o

---

### ğŸ’¾ CAMADA DE BANCO DE DADOS
```
PostgreSQL (Supabase)
    â†“
quiz_responses (tabela principal)
    â”œâ”€ Dados do usuÃ¡rio
    â”œâ”€ Respostas do quiz
    â”œâ”€ AnÃ¡lise da IA (JSONB)
    â””â”€ Metadados (timestamps, flags)
    
profiles (tabela de mentores)
    â””â”€ Mentores disponÃ­veis para matching
```

**Responsabilidades:**
- Persistir respostas do quiz
- Armazenar anÃ¡lise da IA
- Controlar status de processamento
- Rastrear envio de emails
- RLS para seguranÃ§a

---

### âš¡ CAMADA DE EDGE FUNCTIONS (Backend Serverless)

#### Function 1: analyze-quiz
```
supabase/functions/analyze-quiz/index.ts
    â†“
1. Busca resposta do banco
2. Busca mentores disponÃ­veis
3. Gera prompt para IA
4. Chama OpenAI API (gpt-4o-mini)
5. Processa resposta JSON
6. Fallback se IA falhar
7. Atualiza banco com anÃ¡lise
8. Dispara envio de email
```

**Responsabilidades:**
- Orquestrar anÃ¡lise com IA
- Fazer matching com mentores reais
- Calcular pontuaÃ§Ã£o
- Garantir fallback
- Atualizar banco de dados

#### Function 2: send-quiz-email
```
supabase/functions/send-quiz-email/index.ts
    â†“
1. Busca resposta com anÃ¡lise
2. Verifica se jÃ¡ enviou
3. Monta HTML do email
4. Envia via Brevo API
5. Atualiza flag email_sent
```

**Responsabilidades:**
- Enviar email com resultados
- IntegraÃ§Ã£o com Brevo
- Controle de duplicaÃ§Ã£o
- Atualizar status

#### Function 3: send-invite-email
```
supabase/functions/send-invite-email/index.ts
    â†“
1. Recebe nome e email
2. Envia convite para MENVO
3. Fire & forget (nÃ£o bloqueia)
```

**Responsabilidades:**
- Email de boas-vindas
- Convite para plataforma
- NÃ£o bloqueia fluxo principal

---

### ğŸ¤– CAMADA DE IA (ServiÃ§o Externo)
```
OpenAI API
    â†“
Model: gpt-4o-mini
Temperature: 0.7
Response: JSON estruturado
```

**Responsabilidades:**
- Analisar respostas do usuÃ¡rio
- Gerar insights personalizados
- Sugerir mentores adequados
- Calcular pontuaÃ§Ã£o
- Identificar potencial mentor

---

## ğŸ“Š Estrutura de Dados

### QuizFormData (Input)
```typescript
{
  careerMoment: string
  mentorshipExperience: string
  developmentAreas: string[]
  developmentAreasOther?: string
  currentChallenge: string
  futureVision: string
  shareKnowledge: string
  personalLifeHelp: string
  name: string
  email: string
  linkedinUrl?: string
}
```

### AnalysisResult (Output da IA)
```typescript
{
  precisa_refazer?: boolean
  titulo_personalizado: string
  resumo_motivador: string
  mentores_sugeridos: Array<{
    tipo: string
    razao: string
    disponivel: boolean
    mentor_nome?: string
  }>
  conselhos_praticos: string[]
  proximos_passos: string[]
  areas_desenvolvimento: string[]
  mensagem_final: string
  potencial_mentor: boolean
  areas_vida_pessoal: string[]
}
```

### QuizResponse (Banco de Dados)
```typescript
{
  id: UUID
  name: string
  email: string
  linkedin_url?: string
  career_moment: string
  mentorship_experience: string
  development_areas: string[]
  current_challenge: string
  future_vision: string
  share_knowledge: string
  personal_life_help: string
  score: number
  ai_analysis: AnalysisResult (JSONB)
  processed_at: timestamp
  email_sent: boolean
  email_sent_at: timestamp
  created_at: timestamp
  updated_at: timestamp
}
```

---

## ğŸ” SeguranÃ§a e PolÃ­ticas RLS

```sql
-- Qualquer um pode inserir (quiz pÃºblico)
CREATE POLICY "Public can submit quiz responses"
  ON quiz_responses FOR INSERT TO public
  WITH CHECK (true);

-- Qualquer um pode ler por email
CREATE POLICY "Anyone can read responses by email"
  ON quiz_responses FOR SELECT TO public
  USING (true);

-- Qualquer um pode atualizar (para Edge Functions)
CREATE POLICY "Public can update quiz responses"
  ON quiz_responses FOR UPDATE TO public
  USING (true);
```

---

## â±ï¸ Fluxo Temporal

```
T0: UsuÃ¡rio inicia quiz
    â†“ (0-5 min)
T1: UsuÃ¡rio completa 8 perguntas
    â†“ (< 1s)
T2: Dados salvos no banco
    â†“ (< 1s)
T3: Email de convite enviado (async)
    â†“ (< 1s)
T4: Redirecionamento para /results
    â†“ (2-5s)
T5: Edge Function processa com IA
    â†“ (< 1s)
T6: AnÃ¡lise salva no banco
    â†“ (< 1s)
T7: Email com resultados enviado
    â†“ (polling a cada 2s)
T8: Frontend detecta processed_at
    â†“ (instantÃ¢neo)
T9: Resultados exibidos ao usuÃ¡rio
```

**Tempo total:** ~5-10 segundos apÃ³s submit

---

## ğŸ¯ Pontos de IntegraÃ§Ã£o

### Frontend â†” Supabase Client
- `createClient()` - Cria cliente autenticado
- `.from('quiz_responses')` - Queries ao banco
- `.functions.invoke()` - Chama Edge Functions

### Edge Functions â†” OpenAI
- `fetch('https://api.openai.com/v1/chat/completions')`
- Headers: Authorization Bearer token
- Body: messages com prompt estruturado
- Response: JSON com anÃ¡lise

### Edge Functions â†” Brevo
- `fetch('https://api.brevo.com/v3/smtp/email')`
- Headers: api-key
- Body: sender, to, subject, htmlContent
- Response: messageId

### Edge Functions â†” Database
- Supabase Admin Client (service_role)
- Bypass RLS para operaÃ§Ãµes internas
- TransaÃ§Ãµes para consistÃªncia

---

## ğŸš¨ Tratamento de Erros

### Frontend
- Try/catch em handleQuizSubmit
- Toast de erro se falhar
- NÃ£o bloqueia se email de convite falhar

### Edge Functions
- Try/catch em cada funÃ§Ã£o
- Fallback analysis se IA falhar
- Logs detalhados de erro
- Status HTTP apropriados

### Banco de Dados
- Constraints para validaÃ§Ã£o
- Indexes para performance
- RLS para seguranÃ§a

---

## ğŸ”„ Retry e ResilÃªncia

### Polling de Resultados
```typescript
if (!data.processed_at) {
  setTimeout(loadResults, 2000) // retry apÃ³s 2s
  return
}
```

### Fire & Forget
```typescript
// Email de convite nÃ£o bloqueia
supabase.functions.invoke("send-invite-email")
  .catch(err => console.error(err))
```

### Fallback de IA
```typescript
// Se OpenAI falhar, usa anÃ¡lise baseada em regras
if (analysisError) {
  analysisResult = generateFallbackAnalysis(response, mentors)
}
```

---

## ğŸ“ˆ MÃ©tricas e Monitoramento

### Queries Ãšteis
```sql
-- Total de respostas
SELECT COUNT(*) FROM quiz_responses;

-- PontuaÃ§Ã£o mÃ©dia
SELECT AVG(score) FROM quiz_responses WHERE score IS NOT NULL;

-- Taxa de processamento
SELECT 
  COUNT(*) as total,
  SUM(CASE WHEN processed_at IS NOT NULL THEN 1 ELSE 0 END) as processados,
  ROUND(100.0 * SUM(CASE WHEN processed_at IS NOT NULL THEN 1 ELSE 0 END) / COUNT(*), 2) as taxa
FROM quiz_responses;

-- Taxa de envio de email
SELECT 
  COUNT(*) as total,
  SUM(CASE WHEN email_sent THEN 1 ELSE 0 END) as enviados,
  ROUND(100.0 * SUM(CASE WHEN email_sent THEN 1 ELSE 0 END) / COUNT(*), 2) as taxa_envio
FROM quiz_responses;
```

---

## ğŸ¨ Para Visualizar no Excalidraw

Este arquivo pode ser usado como referÃªncia para criar um diagrama visual no Excalidraw. SugestÃµes de elementos:

1. **RetÃ¢ngulos azuis** - Componentes Frontend
2. **RetÃ¢ngulos verdes** - Edge Functions
3. **Cilindros** - Banco de Dados
4. **Nuvens** - ServiÃ§os Externos (OpenAI, Brevo)
5. **Setas** - Fluxo de dados
6. **Cores** - Diferenciar camadas
7. **Ãcones** - Representar aÃ§Ãµes (ğŸ“§ email, ğŸ¤– IA, ğŸ’¾ banco)

---

**Criado para:** Projeto MENVO - Sistema de Quiz com AnÃ¡lise de IA
**Ãšltima atualizaÃ§Ã£o:** 2025-01-13
